<hr>
<h2>
<a id="layout-defaulttitle-cas---oauth-user-managed-access-protocolcategory-protocols" class="anchor" href="#layout-defaulttitle-cas---oauth-user-managed-access-protocolcategory-protocols" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - OAuth User-Managed Access Protocol<br>
category: Protocols</h2>
<h1>
<a id="user-managed-access-protocol" class="anchor" href="#user-managed-access-protocol" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>User-Managed Access Protocol</h1>
<p>User-Managed Access (UMA) is a lightweight access control protocol that defines a centralized workflow to allow an entity (user or corporation)<br>
to manage access to their resources.</p>
<p>To learn more about UMA, please <a href="https://docs.kantarainitiative.org/uma/rec-uma-core.html">read the specification</a>.</p>
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>Support is enabled by including the following dependency in the WAR overlay:</p>
<pre lang="xml"><code>&lt;dependency&gt;
  &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;
  &lt;artifactId&gt;cas-server-support-oauth-uma&lt;/artifactId&gt;
  &lt;version&gt;${cas.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>To see the relevant list of CAS properties for this feature, please <a href="../configuration/Configuration-Properties.html#oauth2-uma">review this guide</a>.</p>
<h2>
<a id="resources-storage" class="anchor" href="#resources-storage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resources Storage</h2>
<p>Resource definitions are by default kept inside an in-memory repository.</p>
<p>CAS also provides an alternative implementation backed by the relational database<br>
of choice to track and manage such definitions. The repository choice is activated in CAS properties.</p>
<p>Support is enabled by including the following dependency in the WAR overlay:</p>
<pre lang="xml"><code>&lt;dependency&gt;
  &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;
  &lt;artifactId&gt;cas-server-support-oauth-uma-jpa&lt;/artifactId&gt;
  &lt;version&gt;${cas.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h2>
<a id="endpoints" class="anchor" href="#endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Endpoints</h2>
<h3>
<a id="requesting-party-token" class="anchor" href="#requesting-party-token" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requesting Party Token</h3>
<p>Issue a <code>GET</code> request to <code>/oauth2.0/umaJwks</code> to retrieve signing public keys.</p>
<h3>
<a id="policies" class="anchor" href="#policies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Policies</h3>
<h4>
<a id="create" class="anchor" href="#create" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create</h4>
<p>Issue a <code>POST</code> request to <code>/oauth2.0/${resourceId}/policy</code> with the payload body as:</p>
<pre lang="json"><code>{
  "permissions": [{
    "subject": "casuser",
    "scopes": ["read","write"],
    "claims": {
        "givenName": "CAS"
      }
    }]
}
</code></pre>
<h4>
<a id="delete" class="anchor" href="#delete" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delete</h4>
<p>Issue a <code>DELETE</code> request as <code>/oauth2.0/${resourceId}/policy/${policyId}</code></p>
<h4>
<a id="update" class="anchor" href="#update" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update</h4>
<p>Issue a <code>PUT</code> request as <code>/oauth2.0/${resourceId}/policy/${policyId}</code> with the payload body as one matching the <code>POST</code> method.</p>
<h4>
<a id="find" class="anchor" href="#find" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Find</h4>
<ul>
<li>Issue a <code>GET</code> request as <code>/oauth2.0/${resourceId}/policy/</code> to fetch all policy definitions for a resource.</li>
<li>Issue a <code>GET</code> request as <code>/oauth2.0/${resourceId}/policy/${policyId}</code> to fetch a specific policy definition for a resource.</li>
</ul>
<h3>
<a id="resources" class="anchor" href="#resources" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resources</h3>
<p>Resource-related operations are handled at endpoint <code>/oauth2.0/resourceSet</code>.</p>
<h4>
<a id="create-1" class="anchor" href="#create-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create</h4>
<p>The expected <code>POST</code> payload body is:</p>
<pre lang="json"><code>{
  "uri": "...",
  "type": "...",
  "name": "...",
  "icon_uri": "...",
  "resource_scopes": ["read","write"]
}
</code></pre>
<h4>
<a id="delete-1" class="anchor" href="#delete-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delete</h4>
<p>Issue a <code>DELETE</code> request as <code>${resourceSetEndpoint}/${resourceId}</code></p>
<h4>
<a id="update-1" class="anchor" href="#update-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update</h4>
<p>Issue a <code>PUT</code> request as <code>${resourceSetEndpoint}/${resourceId}</code> with the payload body as one matching the <code>POST</code> method.</p>
<h4>
<a id="find-1" class="anchor" href="#find-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Find</h4>
<ul>
<li>Issue a <code>GET</code> request as <code>${resourceSetEndpoint}/${resourceId}</code> to fetch a specific resource definition.</li>
<li>Issue a <code>GET</code> request as <code>${resourceSetEndpoint}</code> to fetch all resource definitions.</li>
</ul>
<h3>
<a id="permission-tickets" class="anchor" href="#permission-tickets" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Permission Tickets</h3>
<p>Issue a <code>POST</code> request to <code>/oauth2.0/permission</code> with the payload body as:</p>
<pre lang="json"><code>{
    "claims": {"givenName":"CAS"},
    "resource_id": 100,
    "resource_scopes": ["read"]
}
</code></pre>
<h3>
<a id="claims-collection" class="anchor" href="#claims-collection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Claims Collection</h3>
<p>Issue a <code>GET</code> request to <code>/oauth2.0/rqpClaims</code> with the following query parameters:</p>
<ul>
<li><code>client_id</code></li>
<li><code>redirect_uri</code></li>
<li><code>ticket</code></li>
<li>
<code>state</code> (Optional)</li>
</ul>
<h3>
<a id="discovery" class="anchor" href="#discovery" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Discovery</h3>
<p>UMA discovery is available via <code>GET</code> at <code>/oauth2.0/.well-known/uma-configuration</code>.</p>
<h3>
<a id="authorization" class="anchor" href="#authorization" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authorization</h3>
<p>Issue a <code>POST</code> request to <code>/oauth2.0/rptAuthzRequest</code> with the payload body as:</p>
<pre lang="json"><code>{
    "ticket": "...",
    "rpt": "...",
    "grant_type":"urn:ietf:params:oauth:grant-type:uma-ticket",
    "claim_token": "...",
    "claim_token_format": "..."
}
</code></pre>
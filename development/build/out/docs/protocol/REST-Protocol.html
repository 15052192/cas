<hr>
<h2>
<a id="layout-defaulttitle-cas---cas-rest-protocolcategory-protocols" class="anchor" href="#layout-defaulttitle-cas---cas-rest-protocolcategory-protocols" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - CAS REST Protocol<br>
category: Protocols</h2>
<p>{% include variables.html %}</p>
<h1>
<a id="rest-protocol" class="anchor" href="#rest-protocol" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST Protocol</h1>
<p>The REST protocol allows one to model applications as users, programmatically acquiring<br>
service tickets to authenticate to other applications. This means that other applications would be able<br>
to use a CAS client  to accept Service Tickets rather than to rely upon another technology such as<br>
client SSL certificates for application-to-application authentication of requests. This is achieved<br>
by exposing a way to REST-fully obtain a Ticket Granting Ticket and then use that to obtain a Service Ticket.</p>
<!-- raw HTML omitted -->
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>Support is enabled by including the following to the overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-rest" %}</p>
<h2>
<a id="request-a-ticket-granting-ticket" class="anchor" href="#request-a-ticket-granting-ticket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request a Ticket Granting Ticket</h2>
<pre lang="bash"><code>POST /cas/v1/tickets HTTP/1.0
'Content-type': 'Application/x-www-form-urlencoded'
username=battags&amp;password=password&amp;additionalParam1=paramvalue
</code></pre>
<p>You may also specify a <code>service</code> parameter to verify whether the authenticated user may be allowed to access the given service.</p>
<h3>
<a id="successful-response" class="anchor" href="#successful-response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Successful Response</h3>
<pre lang="bash"><code>201 Created
Location: http://www.whatever.com/cas/v1/tickets/{TGT id}
</code></pre>
<h3>
<a id="unsuccessful-response" class="anchor" href="#unsuccessful-response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unsuccessful Response</h3>
<p>If incorrect credentials are sent, CAS will respond with a <code>401 Unauthorized</code>. A <code>400 Bad Request</code> error will be sent for missing parameters, etc. If you send a media type it does not understand, it will send the <code>415 Unsupported Media Type</code>.</p>
<h3>
<a id="jwt-ticket-granting-tickets" class="anchor" href="#jwt-ticket-granting-tickets" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JWT Ticket Granting Tickets</h3>
<p>Ticket-granting tickets created by the REST protocol may be issued as JWTs instead. Support is enabled by including the following in your overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-rest-tokens" %}</p>
<p>To request a ticket-granting ticket as JWT next, ensure the <code>POST</code> request matches the following:</p>
<pre lang="bash"><code>POST /cas/v1/tickets HTTP/1.0

username=battags&amp;password=password&amp;token=true&amp;additionalParam1=paramvalue
</code></pre>
<p>The <code>token</code> parameter may either be passed as a request parameter or a request header. The body of the response will include the ticket-granting ticket as a JWT. Note that JWTs created are typically signed and encrypted by default with pre-generated keys. To control settings or to see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#jwt-tickets">review this guide</a>.</p>
<h2>
<a id="authenticate-credentials" class="anchor" href="#authenticate-credentials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authenticate Credentials</h2>
<p>Similar to asking for ticket-granting tickets, this endpoint allows one to only verify the validity of provided credentials as they are extracted from the request body:</p>
<pre lang="bash"><code>POST /cas/v1/users HTTP/1.0

username=battags&amp;password=password
</code></pre>
<p>You may also specify a <code>service</code> parameter to verify whether the authenticated user may be allowed to access the given service. While the above example shows <code>username</code> and <code>password</code> as the provided credentials, you are practically allowed to provide multiple sets and different types of credentials provided CAS is equipped to extract and recognize those from the request body. See <a href="#multiple-credentials">this  for more info</a>.</p>
<p>A successful response will produce a <code>200 OK</code> status code along with a JSON representation of the authentication result, which may include the authentication object, authenticated principal along with any captured attributes and/or metadata fetched for the authenticated user.</p>
<h2>
<a id="request-a-service-ticket" class="anchor" href="#request-a-service-ticket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request a Service Ticket</h2>
<p>The below snippets show one might request a service ticket using the semantics of the CAS protocol:</p>
<pre lang="bash"><code>POST /cas/v1/tickets/{TGT id} HTTP/1.0

service={form encoded parameter for the service url}
</code></pre>
<p>You may also specify a <code>renew</code> parameter to obtain a service ticket that can be accepted by a service that only wants tickets issued from the presentation of the user's primary credentials. In that case, user credentials have to be passed in the request, for example, as <code>username</code> and <code>password</code> parameters.</p>
<pre lang="bash"><code>POST /cas/v1/tickets/{TGT id} HTTP/1.0

service={form encoded parameter for the service url}&amp;renew=true&amp;username=battags&amp;password=password
</code></pre>
<p>You may also submit service ticket requests using the semantics <a href="SAML-Protocol.html">SAML1 protocol</a>.</p>
<h3>
<a id="successful-response-1" class="anchor" href="#successful-response-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Successful Response</h3>
<pre lang="bash"><code>200 OK
ST-1-FFDFHDSJKHSDFJKSDHFJKRUEYREWUIFSD2132
</code></pre>
<h3>
<a id="jwt-service-tickets" class="anchor" href="#jwt-service-tickets" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JWT Service Tickets</h3>
<p>Service tickets created by the REST protocol may be issued as JWTs instead. See <a href="../installation/Configure-ServiceTicket-JWT.html">this guide</a> to learn more.</p>
<p>Support is enabled by including the following in your overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-rest-tokens" %}</p>
<p>Note that JWTs created are typically signed and encrypted by default with pre-generated keys. To control settings or to see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#jwt-tickets">review this guide</a>.</p>
<h2>
<a id="validate-service-ticket" class="anchor" href="#validate-service-ticket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validate Service Ticket</h2>
<p>Service ticket validation is handled through the <a href="CAS-Protocol.html">CAS Protocol</a><br>
via any of the validation endpoints such as <code>/p3/serviceValidate</code>.</p>
<pre lang="bash"><code>GET /cas/p3/serviceValidate?service={service url}&amp;ticket={service ticket}
</code></pre>
<h3>
<a id="unsuccessful-response-1" class="anchor" href="#unsuccessful-response-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unsuccessful Response</h3>
<p>CAS will send a 400 Bad Request. If an incorrect media type is<br>
sent, it will send the 415 Unsupported Media Type.</p>
<h2>
<a id="logout" class="anchor" href="#logout" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logout</h2>
<p>Destroy the SSO session by removing the issued ticket:</p>
<pre lang="bash"><code>DELETE /cas/v1/tickets/TGT-fdsjfsdfjkalfewrihfdhfaie HTTP/1.0
</code></pre>
<h2>
<a id="ticket-status" class="anchor" href="#ticket-status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ticket Status</h2>
<p>Verify the status of an obtained ticket to make sure it still is valid<br>
and has not yet expired.</p>
<pre lang="bash"><code>GET /cas/v1/tickets/TGT-fdsjfsdfjkalfewrihfdhfaie HTTP/1.0
</code></pre>
<h3>
<a id="successful-response-2" class="anchor" href="#successful-response-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Successful Response</h3>
<pre lang="bash"><code>200 OK
</code></pre>
<h3>
<a id="unsuccessful-response-2" class="anchor" href="#unsuccessful-response-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unsuccessful Response</h3>
<pre lang="bash"><code>404 NOT FOUND
</code></pre>
<h2>
<a id="add-service" class="anchor" href="#add-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add Service</h2>
<p>Support is enabled by including the following in your overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-rest-services" %}</p>
<p>Invoke CAS to register applications into its own service registry. The REST call must be authenticated using basic authentication where credentials are authenticated and accepted by the existing CAS authentication strategy, and furthermore the authenticated principal must be authorized with a pre-configured role/attribute name and value that is designated in the CAS configuration via the CAS properties. The body of the request must be the service definition that shall be registered in JSON format and of course, CAS must be configured to accept the particular service type defined in the body. The accepted media type for this request is <code>application/json</code>.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#rest-api">review this guide</a>.</p>
<pre lang="bash"><code>POST /cas/v1/services HTTP/1.0
</code></pre>
<p>...where body of the request may be:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "...",
  "name" : "...",
  "id" : 1,
  "description": "..."
}
</code></pre>
<p>A successful response will produce a <code>200</code> status code in return.</p>
<h2>
<a id="x509-authentication" class="anchor" href="#x509-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>X.509 Authentication</h2>
<p>The feature extends the CAS REST API communication model to non-interactive X.509 authentication<br>
where REST credentials may be retrieved from a certificate embedded in the request rather than<br>
the usual and default username/password.</p>
<p>This pattern may be of interest in cases where the internal network architecture hides<br>
the CAS server from external users behind firewall, reverse proxy, or a messaging bus and<br>
allows only trusted applications to connect directly to the CAS server.</p>
<!-- raw HTML omitted -->
<p>It is also possible to let the servlet container validate the TLS client key / X.509 certificate<br>
during TLS handshake, and have CAS server retrieve the certificate from the container.</p>
<p>Support is enabled by including the following in your overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-rest-x509" %}</p>
<h3>
<a id="request-a-ticket-granting-ticket-proxy-tls-client-authentication-using-a-body-parameter" class="anchor" href="#request-a-ticket-granting-ticket-proxy-tls-client-authentication-using-a-body-parameter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request a Ticket Granting Ticket (Proxy TLS Client Authentication using a body parameter)</h3>
<pre lang="bash"><code>POST /cas/v1/tickets HTTP/1.0
cert=&lt;ascii certificate&gt;
</code></pre>
<h3>
<a id="request-a-ticket-granting-ticket-proxy-tls-client-authentication-using-a-http-header" class="anchor" href="#request-a-ticket-granting-ticket-proxy-tls-client-authentication-using-a-http-header" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request a Ticket Granting Ticket (Proxy TLS Client Authentication using a http header)</h3>
<p>The cas server should be configured for X509 authentication on the login page for<br>
this to function properly.</p>
<h3>
<a id="request-a-ticket-granting-ticket-tls-client-authentication-from-the-servlet-container" class="anchor" href="#request-a-ticket-granting-ticket-tls-client-authentication-from-the-servlet-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request a Ticket Granting Ticket (TLS Client Authentication from the servlet container)</h3>
<p>The cas server should be configured for X509 authentication on the login page for<br>
this to function properly.</p>
<h4>
<a id="successful-response-3" class="anchor" href="#successful-response-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Successful Response</h4>
<pre lang="bash"><code>201 Created
Location: http://www.whatever.com/cas/v1/tickets/{TGT id}
</code></pre>
<h2>
<a id="multiple-credentials" class="anchor" href="#multiple-credentials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple Credentials</h2>
<p>The CAS REST API machinery has the ability to use multiple <em>credential extractors</em> that are tasked with analyzing the request body in order to fetch credentials and pass them along. While by default expected credentials that may be extracted are based on username/password, additional modules automatically lend themselves into this design and inject their opinionated credential extractor into the REST engine automatically so that the final collection of credentials may be used for issuing tickets, etc. This is, in a sense, how the <a href="#x509-authentication">X.509 authentication</a> is integrated with the CAS REST Protocol.</p>
<p>This indicates that you may pass along multiple credentials to the REST protocol in the request body and so long as CAS is configured to understand and extract those credentials and the authentication machinery is configured to also execute and validate those credentials. For instance, you may deliver a use case where two sets of credentials in form of username/password and OTP are provided to the REST protocol and CAS would then attempt to authenticate both credentials and produce a response on a successful validation, assuming that authentication strategies for username/password and OTP are properly configured in CAS.</p>
<h2>
<a id="cas-rest-clients" class="anchor" href="#cas-rest-clients" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CAS REST Clients</h2>
<p>In order to interact with the CAS REST API, a REST client must be used to submit credentials,<br>
receive tickets and validate them. The following Java REST client is available<br>
by <a href="https://github.com/pac4j/pac4j">pac4j</a>:</p>
<pre lang="java"><code>import org.pac4j.cas.profile.CasRestProfile;
import org.pac4j.cas.client.rest.CasRestFormClient;
import org.pac4j.cas.config.CasConfiguration;
import org.pac4j.cas.credentials.authenticator.CasRestAuthenticator;
import org.pac4j.cas.profile.CasProfile;
import org.pac4j.core.context.JEEContext;
import org.pac4j.core.context.WebContext;
import org.pac4j.core.credentials.TokenCredentials;
import org.pac4j.core.credentials.UsernamePasswordCredentials;
import org.pac4j.core.exception.HttpAction;
import org.springframework.mock.web.MockHttpServletRequest;
import org.springframework.mock.web.MockHttpServletResponse;

import java.util.Map;
import java.util.Set;

public class RestTestClient {

    public static void main(String[] args ) throws HttpAction {
        final String casUrlPrefix = "http://localhost:8080/cas";
        String username = args[0];
        String password = args[1];
        String serviceUrl = args[2];
        CasConfiguration casConfiguration = new CasConfiguration(casUrlPrefix);
        final CasRestAuthenticator authenticator = new CasRestAuthenticator(casConfiguration);
        final CasRestFormClient client = new CasRestFormClient(casConfiguration,"username","password");
        final MockHttpServletRequest request = new MockHttpServletRequest();
        final MockHttpServletResponse response = new MockHttpServletResponse();

        final WebContext webContext = new JEEContext(request, response);
        casConfiguration.init(webContext);
        UsernamePasswordCredentials credentials = new UsernamePasswordCredentials(username,password,"testclient");
        CasRestAuthenticator restAuthenticator = new CasRestAuthenticator(casConfiguration);
        // authenticate with credentials (validate credentials)
        restAuthenticator.validate(credentials, webContext);
        final CasRestProfile profile = (CasRestProfile) credentials.getUserProfile();
        // get service ticket
        final TokenCredentials casCredentials = client.requestServiceTicket(serviceUrl, profile, webContext);
        // validate service ticket
        final CasProfile casProfile = client.validateServiceTicket(serviceUrl, casCredentials, webContext);
        Map&lt;String,Object&gt; attributes = casProfile.getAttributes();
        Set&lt;Map.Entry&lt;String,Object&gt;&gt; mapEntries = attributes.entrySet();
        for (Map.Entry entry : mapEntries) {
            System.out.println(entry.getKey() + ":" + entry.getValue());
        }
        client.destroyTicketGrantingTicket(profile,webContext);
    }
}


</code></pre>
<h2>
<a id="throttling" class="anchor" href="#throttling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Throttling</h2>
<p>To understand how to throttling works in CAS,<br>
please review <a href="../installation/Configuring-Authentication-Throttling.html">the available options</a>.<br>
By default, throttling REST requests is turned off.<br>
To activate this functionality, you will need to choose an appropriate throttler and activate it by declaring the relevant module.<br>
The same throttling mechanism that handles the usual CAS server endpoints for authentication<br>
and ticket validation, etc is then activated for the REST endpoints that are supported for throttling.</p>
<p>To see the relevant options, <a href="https://apereo.github.io/cas/development/configuration/Configuration-Properties.html#rest-api">please review this guide</a>.</p>
<h2>
<a id="swagger-api" class="anchor" href="#swagger-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Swagger API</h2>
<p>CAS REST API may be automatically integrated with Swagger. <a href="../integration/Swagger-Integration.html">See this guide</a> for more info.</p>
<hr>
<h2>
<a id="layout-defaulttitle-cas---release-processcategory-developer" class="anchor" href="#layout-defaulttitle-cas---release-processcategory-developer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Release Process<br>
category: Developer</h2>
<h1>
<a id="cas-release-process" class="anchor" href="#cas-release-process" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CAS Release Process</h1>
<p>This page documents the steps that a release engineer should take for cutting a CAS server release.</p>
<h2>
<a id="sonatype-setup" class="anchor" href="#sonatype-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sonatype Setup</h2>
<p>You will need to sign up for a <a href="https://central.sonatype.org/pages/ossrh-guide.html">Sonatype account</a> and must ask<br>
to be authorized to publish releases to the <code>org.apereo</code> package by creating a JIRA. Once you have, you may be asked to have one of the<br>
current project members <em>vouch</em> for you.</p>
<h2>
<a id="gpg-setup" class="anchor" href="#gpg-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GPG Setup</h2>
<p>You will need to <a href="https://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven/">generate your own PGP signatures</a> to sign the release artifacts prior to uploading them to a central repository. In order to create OpenPGP signatures, you will need to generate a key pair. You need to provide the build with your key information, which means three things:</p>
<ul>
<li>The public key ID (The last 8 symbols of the keyId. You can use <code>gpg -K</code> to get it</li>
<li>The absolute path to the secret key ring file containing your private key. Since gpg 2.1, you need to export the keys with command:</li>
</ul>
<pre lang="bash"><code>gpg --keyring secring.gpg --export-secret-keys &gt; ~/.gnupg/secring.gpg
</code></pre>
<ul>
<li>The passphrase used to protect your private key.</li>
</ul>
<p>The above settings will need to be placed into the <code>~/.gradle/gradle.properties</code> file:</p>
<pre lang="properties"><code>signing.keyId=7A24P9QB
signing.password=P@$$w0rd
signing.secretKeyRingFile=/Users/example/.gnupg/secring.gpg
</code></pre>
<p>Additional notes on how artifacts are signed using the Gradle<br>
signing plugin are <a href="https://docs.gradle.org/current/userguide/signing_plugin.html">available here</a></p>
<h2>
<a id="environment-setup" class="anchor" href="#environment-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment Setup</h2>
<ul>
<li>Load your SSH key and ensure this SSH key is also referenced in GitHub.</li>
<li>Adjust <code>$GRADLE_OPTS</code> to initialize the JVM heap size, if necessary.</li>
<li>Load your <code>~/.gradle/gradle.properties</code> file with the following <em>as an example</em>:</li>
</ul>
<pre lang="properties"><code>org.gradle.daemon=false
org.gradle.parallel=false
</code></pre>
<ul>
<li>Checkout the CAS project: <code>git clone git@github.com:apereo/cas.git cas-server</code>
</li>
<li>Make sure you have the <a href="https://openjdk.java.net/projects/jdk/11/">latest version of JDK 11</a> installed via <code>java -version</code>.</li>
</ul>
<h2>
<a id="preparing-the-release" class="anchor" href="#preparing-the-release" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preparing the Release</h2>
<p>Apply the following steps to prepare the release environment. There are a few variations to take into account depending on whether<br>
a new release branch should be created.</p>
<h3>
<a id="create-branch" class="anchor" href="#create-branch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create Branch</h3>
<pre lang="bash"><code># Replace $BRANCH with CAS version (i.e. 5.3.x)
git checkout -b $BRANCH
</code></pre>
<!-- raw HTML omitted -->
<h3>
<a id="github-actions" class="anchor" href="#github-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GitHub Actions</h3>
<!-- raw HTML omitted -->
<ul>
<li>Change <code>.github/workflows/cas-build.yml</code> to trigger and <em>only</em> build the newly-created release branch. Scan the file to make sure all references point to the newly-created release branch.</li>
<li>Examine all CI shell scripts under the <code>ci</code> folder to make sure nothing points to <code>development</code> or <code>master</code>. This is particularly applicable to how CAS documentation is published to the <code>gh-pages</code> branch.</li>
<li>Disable jobs in CI that report new dependency versions, update dependencies using Renovate, publish Docker images, etc.</li>
</ul>
<p>Do not forget to commit all changes and push changes upstream, creating a new remote branch to track the release.</p>
<h2>
<a id="performing-the-release" class="anchor" href="#performing-the-release" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Performing the Release</h2>
<ul>
<li>In the project's <code>gradle.properties</code>, change the project version to the release version and remove the <code>-SNAPSHOT</code>. (i.e. <code>6.0.0-RC1</code>).</li>
<li>Build and release the project using the following command:</li>
</ul>
<pre lang="bash"><code>./release.sh
</code></pre>
<h2>
<a id="finalizing-the-release" class="anchor" href="#finalizing-the-release" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Finalizing the Release</h2>
<ul>
<li>Create a tag for the released version, commit the change and push the tag to the upstream repository. (i.e. <code>v5.0.0-RC1</code>).</li>
</ul>
<p>You should also switch back to the main development branch (i.e. <code>master</code>) and follow these steps:</p>
<ul>
<li>In the project's <code>gradle.properties</code>, change the project version to the <em>next</em> development version (i.e. <code>5.0.0-SNAPSHOT</code>).</li>
<li>Push your changes to the upstream repository.</li>
</ul>
<h2>
<a id="housekeeping" class="anchor" href="#housekeeping" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Housekeeping</h2>
<!-- raw HTML omitted -->
<ul>
<li>Mark the release tag as pre-release, when releasing RC versions of the project on GitHub.</li>
</ul>
<h2>
<a id="update-overlays" class="anchor" href="#update-overlays" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update Overlays</h2>
<p>Update the following overlay projects to point to the newly released CAS version. You may need to move the current <code>master</code> branch<br>
over to a maintenance branch for each of the below overlay projects, specially if/when dealing with major/minor releases<br>
and if the release process here had you create a new branch.</p>
<ul>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS WAR Overlay</a></li>
</ul>
<h2>
<a id="update-documentation" class="anchor" href="#update-documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update Documentation</h2>
<!-- raw HTML omitted -->
<ul>
<li>Configure docs to point <code>current</code> to the latest available version <a href="https://github.com/apereo/cas/blob/gh-pages/current/index.html">here</a>.</li>
<li>Configure docs to include the new release in the list of <a href="https://github.com/apereo/cas/blob/gh-pages/_layouts/default.html">available versions</a>.</li>
<li>
<a href="https://github.com/apereo/cas/edit/gh-pages/Older-Versions.md/">Update docs</a> and add the newly released version.</li>
<li>Update the project's <a href="https://github.com/apereo/cas/blob/master/README.md"><code>README.md</code> page</a> to list the new version, if necessary.</li>
<li>Update <a href="Build-Process.html">the build process</a> to include any needed information on how to build the new release.</li>
<li>Update <a href="../release_notes/Overview.html">the release notes</a> and remove all previous entries.</li>
</ul>
<h2>
<a id="update-maintenance-policy" class="anchor" href="#update-maintenance-policy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update Maintenance Policy</h2>
<p>Update the <a href="https://github.com/apereo/cas/edit/gh-pages/developer/Maintenance-Policy.md/">Maintenance Policy</a> to note the release schedule and EOL timeline.<br>
This task is only relevant when dealing with major or minor releases.</p>
<h2>
<a id="update-demos" class="anchor" href="#update-demos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Update Demos</h2>
<p>(Optional) A number of CAS demos today run on Heroku and are tracked in dedicated<br>
branches inside the codebase. Take a pass and update each, when relevant.</p>
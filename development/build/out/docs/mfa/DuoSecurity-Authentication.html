<hr>
<h2>
<a id="layout-defaulttitle-cas---duo-security-authenticationcategory-multifactor-authentication" class="anchor" href="#layout-defaulttitle-cas---duo-security-authenticationcategory-multifactor-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Duo Security Authentication<br>
category: Multifactor Authentication</h2>
<h1>
<a id="duo-security-authentication" class="anchor" href="#duo-security-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Duo Security Authentication</h1>
<p><a href="https://www.duo.com">Duo Security</a> is a two-step verification service the provides<br>
additional security for access to institutional and personal data.</p>
<p>Duo offers several options for authenticating users:</p>
<ul>
<li>a mobile push notification and one-button verification of identity to a smartphone (requires the free Duo Mobile app)</li>
<li>a one-time code generated on a smartphone</li>
<li>a one-time code generated by Duo and sent to a handset via SMS text messaging</li>
<li>a telephone call from that will prompt you to validate the login request</li>
</ul>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-duo" %}</p>
<p>You may need to add the following repositories to the WAR overlay:</p>
<pre lang="groovy"><code>repositories {
    maven { 
        mavenContent { releasesOnly() }
        url "https://dl.bintray.com/uniconiam/maven" 
    }
}
</code></pre>
<h2>
<a id="administrative-endpoints" class="anchor" href="#administrative-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Administrative Endpoints</h2>
<p>The following endpoints are provided by CAS:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>duoPing</code></td>
<td>Pings the Duo Security API to check for service availability. Can accept an optional <code>providerId</code> parameter.</td>
</tr>
<tr>
<td><code>duoAccountStatus/${username}</code></td>
<td>Fetch the account status for the requested username. Can accept an optional <code>providerId</code> parameter.</td>
</tr>
</tbody>
</table>
<h2>
<a id="multiple-instances" class="anchor" href="#multiple-instances" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple Instances</h2>
<p>CAS multifactor authentication support for Duo Security allows<br>
multiple Duo providers to be configured with distinct ids each of<br>
which may be connected to a separate Duo Security instance with a different configuration.<br>
This behavior allows more sensitive applications to be connected<br>
to a Duo instance that has more strict and secure authentication policies.</p>
<p>For this behavior to function, separate unique ids of your own choosing need to be assigned to each Duo Security<br>
provider. Each provider instance is registered with CAS and activated in the authentication<br>
flows as necessary. The provider id need not be defined if there is only a single Duo instance available.</p>
<h2>
<a id="user-account-status" class="anchor" href="#user-account-status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>User Account Status</h2>
<p>If users are unregistered with Duo Security or allowed through via a direct bypass,<br>
CAS will query Duo Security for the user account apriori to learn<br>
whether user is registered or configured for direct bypass. If the account is configured for direct bypass or the<br>
user account is not registered yet the new-user enrollment policy allows the user to skip registration, CAS will bypass<br>
Duo Security altogether and shall not challenge the user and will also <strong>NOT</strong> report back a multifactor-enabled<br>
authentication context back to the application.</p>
<!-- raw HTML omitted -->
<h2>
<a id="health-status" class="anchor" href="#health-status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Health Status</h2>
<p>CAS is able to contact Duo Security, on demand, in order to inquire the health status of the service using Duo Security's <code>ping</code> API.<br>
The results of the operations are recorded and reported using <code>health</code> endpoint<br>
provided by <a href="../monitoring/Monitoring-Statistics.html">CAS Monitoring endpoints</a>.<br>
Of course, the same result throughout the Duo authentication flow is also used to determine failure modes.</p>
<h2>
<a id="universal-prompt" class="anchor" href="#universal-prompt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Universal Prompt</h2>
<p>Universal Prompt is a variation of Duo Multifactor Authentication that uses the <a href="https://duo.com/docs/oauthapi">Duo OIDC Auth API</a>. This is<br>
an OIDC standards-based API for adding strong two-factor authentication to CAS. This option no longer displays the Duo Prompt<br>
in an iFrame controlled and owned by CAS. Rather, the prompt is now hosted on Duoâ€™s servers and displayed via browser redirects. The<br>
response from Duo Security is passed to CAS as a browser redirect and CAS will begin to negotiate and exchange that response in favor of<br>
a JWT that contains the multifactor authentication user profile details.</p>
<p>This option only required settings for integration key, secret key, and API hostname. To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#duosecurity">review this guide</a>.</p>
<h2>
<a id="non-browser-mfa" class="anchor" href="#non-browser-mfa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Non-Browser MFA</h2>
<p>The Duo Security module of CAS is able to also support <a href="https://duo.com/docs/authapi">non-browser based multifactor authentication</a> requests.<br>
In order to trigger this behavior, applications (i.e. <code>curl</code>, REST APIs, etc) need to specify a special<br>
<code>Content-Type</code> to signal to CAS that the request is submitted from a non-web based environment.<br>
The multifactor authentication request is <a href="https://duo.com/docs/authapi#/auth">submitted to Duo Security</a> in <code>auto</code> mode which effectively may<br>
translate into an out-of-band factor (push or phone) recommended by Duo as the best for the user's devices.</p>
<p>In order to successfully complete the authentication flow, CAS must also be configured with a method<br>
of primary authentication that is able to support non-web based environments<br>
such as <a href="../installation/Basic-Authentication.html">Basic Authentication</a>.</p>
<p>Here is an example using <code>curl</code> that attempts to authenticate into a service by first exercising<br>
basic authentication while identifying the request content type as <code>application/cas</code>. It is assumed that the<br>
service below is configured in CAS with a special multifactor policy that forces the flow<br>
to pass through Duo Security as well.</p>
<pre lang="bash"><code>curl --location --header "Content-Type: application/cas" https://apps.example.org/myapp -L -u casuser:Mellon
</code></pre>
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#duosecurity">review this guide</a>.</p>
<h2>
<a id="troubleshooting" class="anchor" href="#troubleshooting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Troubleshooting</h2>
<p>To enable additional logging, configure the log4j configuration file to add the following<br>
levels:</p>
<pre lang="xml"><code>...
&lt;Logger name="com.duosecurity" level="debug" additivity="false"&gt;
    &lt;AppenderRef ref="console"/&gt;
    &lt;AppenderRef ref="file"/&gt;
&lt;/Logger&gt;
...
</code></pre>
<p>You should also use NTP to ensure that your CAS server's time is correct. Furthermore, CAS typically communicates with<br>
Duo's service on TCP port 443. Firewall configurations that restrict outbound access to<br>
Duo's service with rules using destination IP addresses or IP address ranges are not recommended per Duo Security,<br>
since these may change over time to maintain our service's high availability.</p>
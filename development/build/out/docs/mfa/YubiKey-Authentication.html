<hr>
<h2>
<a id="layout-defaulttitle-cas---yubikey-authenticationcategory-multifactor-authentication" class="anchor" href="#layout-defaulttitle-cas---yubikey-authenticationcategory-multifactor-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - YubiKey Authentication<br>
category: Multifactor Authentication</h2>
<h1>
<a id="yubikey-authentication" class="anchor" href="#yubikey-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>YubiKey Authentication</h1>
<p>Yubico is a cloud-based service that enables strong, easy-to-use and affordable two-factor authentication with one-time passwords through their flagship product, YubiKey. Once Yubico <code>clientId</code> and <code>secretKey</code> are obtained, then the<br>
configuration options available to use YubiKey devices as a primary authentication source that CAS server could use to authenticate users.</p>
<p>To configure YubiKey accounts and obtain API keys, <a href="https://upgrade.yubico.com/getapikey/">refer to the documentation</a>.</p>
<p><a href="https://www.yubico.com/products/yubikey-hardware">YubiKey</a> authentication components are enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey" %}</p>
<h2>
<a id="administrative-endpoints" class="anchor" href="#administrative-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Administrative Endpoints</h2>
<p>The following endpoints are provided by CAS:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>yubikeyAccountRepository</code></td>
<td>Manage and control <a href="YubiKey-Authentication.html">Google Authenticator account records</a>. A <code>GET</code> operation produces a list of all account records. A <code>DELETE</code> operation will delete all account records. A <code>GET</code> operation produces with a parameter selector of <code>/{username}</code> will list the record assigned to the user. A <code>DELETE</code> operation produces with a parameter selector of <code>/{username}</code> will remove the record assigned to the user.</td>
</tr>
</tbody>
</table>
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a>.</p>
<p>By default, all YubiKey accounts for users are allowed to authenticate. Devices that need to be authorized for authentication need to have followed an out-of-band registration process where the record for them is found in one of the following storage backends. Upon authentication, CAS will begin to search the configured registration database for matching record for the authenticated user and device in order to allow for a successful authentication event.</p>
<h3>
<a id="json" class="anchor" href="#json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON</h3>
<p>Registration records may be tracked inside a JSON file, provided the file path is specified in CAS settings. See <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a> for more info.</p>
<p>The JSON structure is a map of user id to yubikey public id representing any particular device:</p>
<pre lang="json"><code>{
  "uid1": ["yubikeyPublicId1"],
  "uid2": ["yubikeyPublicId2"]
}
</code></pre>
<h3>
<a id="rest" class="anchor" href="#rest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST</h3>
<p>Registration records can be managed via an external REST API. See <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a> for more info.</p>
<p>The following endpoints are expected to be available and implemented by the REST API:</p>
<p>| METHOD              | Endpoint        | Description<br>
|--------------------------------------------------------------------------------------<br>
| <code>GET</code>              | <code>/</code>              | Get all registered records.<br>
| <code>GET</code>              | <code>/{user}</code>        | Get all registered records for the user.<br>
| <code>DELETE</code>           | <code>/</code>              | Delete all registered records.<br>
| <code>DELETE</code>           | <code>/{user}</code>        | Delete all registered records for the user.<br>
| <code>DELETE</code>           | <code>/{user}/{id}</code>   | Delete the registered device by its id from the the registration record for the user.<br>
| <code>POST</code>             | <code>/</code>              | Store registration records passed as the request body.</p>
<h3>
<a id="permissive" class="anchor" href="#permissive" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Permissive</h3>
<p>Registration records may be specified statically via CAS settings in form of a map that links registered usernames<br>
with the public id of the YubiKey device. See <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a> for more info.</p>
<h3>
<a id="jpa" class="anchor" href="#jpa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JPA</h3>
<p>Support is enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey-jpa" %}</p>
<p>The expected database schema that is automatically created and configured by CAS contains a single table as <code>YubiKeyAccount</code> with the following fields:</p>
<p>| Field              | Description<br>
|--------------------------------------------------------------------------------------<br>
| <code>id</code>               | Unique record identifier, acting as the primary key.<br>
| <code>publicId</code>         | The public identifier/key of the device used for authentication.<br>
| <code>username</code>         | The username whose device is registered.</p>
<h3>
<a id="couchdb" class="anchor" href="#couchdb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CouchDb</h3>
<p>Support is enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey-couchdb" %}</p>
<p>The registration records are kept inside a single CouchDb database of your choosing that will be auto-created by CAS.<br>
The structure of this database's documents is as follows:</p>
<p>| Field              | Description<br>
|--------------------------------------------------------------------------------------<br>
| <code>id</code>               | Unique record identifier, acting as the primary key.<br>
| <code>publicId</code>         | The public identifier/key of the device used for authentication.<br>
| <code>username</code>         | The username whose device is registered.</p>
<h3>
<a id="redis" class="anchor" href="#redis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Redis</h3>
<p>Support is enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey-redis" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a>.</p>
<h3>
<a id="dynamodb" class="anchor" href="#dynamodb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DynamoDb</h3>
<p>Support is enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey-dynamodb" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a>.</p>
<h3>
<a id="mongodb" class="anchor" href="#mongodb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MongoDb</h3>
<p>Support is enabled by including the following dependencies in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-yubikey-mongo" %}</p>
<p>The registration records are kept inside a single MongoDb collection of your choosing that will be auto-created by CAS.<br>
The structure of this collection is as follows:</p>
<p>| Field              | Description<br>
|--------------------------------------------------------------------------------------<br>
| <code>id</code>               | Unique record identifier, acting as the primary key.<br>
| <code>publicId</code>         | The public identifier/key of the device used for authentication.<br>
| <code>username</code>         | The username whose device is registered.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#yubikey">review this guide</a>.</p>
<h3>
<a id="custom" class="anchor" href="#custom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom</h3>
<p>If you wish to plug in a custom registry implementation that would determine<br>
which users are allowed to use their YubiKey accounts for authentication, you may plug in a custom implementation of the <code>YubiKeyAccountRegistry</code> that allows you to provide a mapping between usernames and YubiKey public keys.</p>
<pre lang="java"><code>package org.apereo.cas.support.yubikey;

@Configuration("myYubiKeyConfiguration")
@EnableConfigurationProperties(CasConfigurationProperties.class)
public class MyYubiKeyConfiguration {

  @Bean
  public YubiKeyAccountRegistry yubiKeyAccountRegistry() {
      ...
  }
}
</code></pre>
<h2>
<a id="device-registrations" class="anchor" href="#device-registrations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Device Registrations</h2>
<p>In the event that a new YubiKey should be registered, it may be desirable to execute additional validation processes before the account is registered with the underlying store. By default, the device registration step only verifies the device token. If you wish to extend this behavior, you can design your own validator that cross-checks the account against alternative sources and databases for validity and authorization:</p>
<pre lang="java"><code>package org.apereo.cas.support.yubikey;

@Configuration("myYubiKeyConfiguration")
@EnableConfigurationProperties(CasConfigurationProperties.class)
public class MyYubiKeyConfiguration {

  @Bean
  public YubiKeyAccountValidator yubiKeyAccountValidator() {
      ...
  }
}
</code></pre>
<p><a href="../configuration/Configuration-Management-Extensions.html">See this guide</a> to learn more about how to register configurations into the CAS runtime.</p>
<h2>
<a id="rest-protocol-credential-extraction" class="anchor" href="#rest-protocol-credential-extraction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST Protocol Credential Extraction</h2>
<p>In the event that the <a href="../protocol/REST-Protocol.html">CAS REST Protocol</a> is turned on, a special credential extractor is injected into the REST authentication engine in order to recognize YubiKey credentials and authenticate them as part of the REST request. The expected parameter name in the request body is <code>yubikeyotp</code>.</p>
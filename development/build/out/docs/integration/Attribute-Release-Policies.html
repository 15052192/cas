<hr>
<h2>
<a id="layout-defaulttitle-cas---attribute-release-policiescategory-attributes" class="anchor" href="#layout-defaulttitle-cas---attribute-release-policiescategory-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Attribute Release Policies<br>
category: Attributes</h2>
<h1>
<a id="attribute-release-policies" class="anchor" href="#attribute-release-policies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attribute Release Policies</h1>
<p>The attribute release policy decides how attributes are selected and provided to a given application in the final CAS response. Additionally, each policy has the ability to apply an optional filter to weed out their attributes based on their values.</p>
<p>The following settings are shared by all attribute release policies:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>authorizedToReleaseCredentialPassword</code></td>
<td>Boolean to define whether the service is authorized to <a href="ClearPass.html">release the credential as an attribute</a>.</td>
</tr>
<tr>
<td><code>authorizedToReleaseProxyGrantingTicket</code></td>
<td>Boolean to define whether the service is authorized to <a href="../installation/Configuring-Proxy-Authentication.html">release the proxy-granting ticket id as an attribute</a>.</td>
</tr>
<tr>
<td><code>excludeDefaultAttributes</code></td>
<td>Boolean to define whether this policy should exclude the default global bundle of attributes for release.</td>
</tr>
<tr>
<td><code>authorizedToReleaseAuthenticationAttributes</code></td>
<td>Boolean to define whether this policy should exclude the authentication/protocol attributes for release. Authentication attributes are considered those that are not tied to a specific principal and define extra supplementary metadata about the authentication event itself, such as the commencement date.</td>
</tr>
<tr>
<td><code>principalIdAttribute</code></td>
<td>An attribute name of your own choosing that will be stuffed into the final bundle of attributes, carrying the CAS authenticated principal identifier. By default, the principal id is <em>NOT</em> released as an attribute.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p>CAS makes a distinction between attributes that convey metadata about the authentication event versus<br>
those that contain personally identifiable data for the authenticated principal.</p>
<h2>
<a id="administrative-endpoints" class="anchor" href="#administrative-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Administrative Endpoints</h2>
<p>The following endpoints are provided by CAS:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>releaseAttributes</code></td>
<td>Invoke the CAS <a href="../integration/Attribute-Release.html">attribute release</a> engine to release attributes to an application.</td>
</tr>
</tbody>
</table>
<p>Supported parameters are the following:</p>
<table>
<thead>
<tr>
<th>Query Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>username</code></td>
<td>The username to use for authentication.</td>
</tr>
<tr>
<td><code>password</code></td>
<td>The password to use for authentication.</td>
</tr>
<tr>
<td><code>service</code></td>
<td>Service to which attributes should be released.</td>
</tr>
</tbody>
</table>
<p>The parameters above can either be added as query string parameters or as a JSON object submitted with a POST:</p>
<pre lang="json"><code>{ 
  "username": "USERNAME",
  "password": "PASSWORD",
  "service": "SERVICE_URL"
}
</code></pre>
<h2>
<a id="authentication-attributes" class="anchor" href="#authentication-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication Attributes</h2>
<p>During the authentication process, a number of attributes get captured and collected by CAS<br>
to describe metadata and additional properties about the nature of the authentication event itself.<br>
These typically include attributes that are documented and classified by the underlying protocol<br>
or attributes that are specific to CAS which may describe the type of credentials used, successfully-executed<br>
authentication handlers, date/time of the authentication, etc.</p>
<p>Releasing authentication attributes to service providers and applications can be<br>
controlled to some extent. To learn more and see the relevant list of CAS properties,<br>
please <a href="../configuration/Configuration-Properties.html#authentication-attributes">review this guide</a>.</p>
<h2>
<a id="principal-attributes" class="anchor" href="#principal-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Principal Attributes</h2>
<p>Principal attributes typically convey personally identifiable data about the authenticated user,<br>
such as address, last name, etc. Release policies are available in CAS and documented below<br>
to explicitly control the collection of attributes that may be authorized for release to a given application.</p>
<!-- raw HTML omitted -->
<h3>
<a id="default" class="anchor" href="#default" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default</h3>
<p>CAS provides the ability to release a bundle of principal attributes to all services by default. This bundle is not defined on a per-service basis and is always combined with attributes produced by the specific release policy of the service, such that for instance, you can devise rules to always release <code>givenName</code> and <code>cn</code> to every application, and additionally allow other specific principal attributes for only some applications per their attribute release policy.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#default-bundle">review this guide</a>.</p>
<h3>
<a id="return-all" class="anchor" href="#return-all" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return All</h3>
<p>Return all resolved principal attributes to the service.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 100,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnAllAttributeReleasePolicy"
  }
}
</code></pre>
<h3>
<a id="deny-all" class="anchor" href="#deny-all" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deny All</h3>
<p>Never ever return principal attributes to applications. Note that this policy<br>
also skips and refuses to release default attributes, if any.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 100,
  "description" : "sample",
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.DenyAllAttributeReleasePolicy"
  }
}
</code></pre>
<h3>
<a id="return-allowed" class="anchor" href="#return-allowed" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return Allowed</h3>
<p>Only return the principal attributes that are explicitly allowed by the service definition.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 100,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnAllowedAttributeReleasePolicy",
    "allowedAttributes" : [ "java.util.ArrayList", [ "cn", "mail", "sn" ] ]
  }
}
</code></pre>
<h3>
<a id="return-encrypted" class="anchor" href="#return-encrypted" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return Encrypted</h3>
<p>Encrypt and encode all all allowed attributes in base-64 using the assigned registered service public key.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 100,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnEncryptedAttributeReleasePolicy",
    "allowedAttributes" : [ "java.util.ArrayList", [ "cn", "mail", "sn" ] ]
  },
  "publicKey" : {
    "@class" : "org.apereo.cas.services.RegisteredServicePublicKeyImpl",
    "location" : "classpath:public.key",
    "algorithm" : "RSA"
  }
}
</code></pre>
<p>The keys can be generated via the following commands:</p>
<pre lang="bash"><code>openssl genrsa -out private.key 1024
openssl rsa -pubout -in private.key -out public.key -inform PEM -outform DER
openssl pkcs8 -topk8 -inform PER -outform DER -nocrypt -in private.key -out private.p8
</code></pre>
<h3>
<a id="rest" class="anchor" href="#rest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST</h3>
<p>Only return the principal attributes that are explicitly allowed by contacting a REST endpoint. Endpoints must be designed to accept/process <code>application/json</code>. The expected response status code is <code>200</code> where the body of the response includes a <code>Map</code> of attributes linked to their values.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 100,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnRestfulAttributeReleasePolicy",
    "endpoint" : "https://somewhere.example.org"
  }
}
</code></pre>
<p>The following parameters are passed to the endpoint:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>principal</code></td>
<td>The object representing the authenticated principal.</td>
</tr>
<tr>
<td><code>service</code></td>
<td>The object representing the corresponding service definition in the registry.</td>
</tr>
</tbody>
</table>
<p>The body of the submitted request may also include a <code>Map</code> of currently resolved attributes.</p>
<h3>
<a id="return-mapped" class="anchor" href="#return-mapped" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return Mapped</h3>
<p>Similar to above, this policy will return a collection of allowed principal attributes for the<br>
service, but also allows those principal attributes to be mapped and "renamed" at the more granular service level.</p>
<p>For example, the following configuration will recognize the resolved<br>
attributes <code>eduPersonAffiliation</code> and <code>groupMembership</code> and will then<br>
release <code>affiliation</code> and <code>group</code> to the web application configured.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "description" : "sample",
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnMappedAttributeReleasePolicy",
    "allowedAttributes" : {
      "@class" : "java.util.TreeMap",
      "eduPersonAffiliation" : "affiliation",
      "groupMembership" : "group"
    }
  }
}
</code></pre>
<h3>
<a id="return-multimapped" class="anchor" href="#return-multimapped" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return MultiMapped</h3>
<p>The same policy may allow attribute definitions to be renamed and remapped to multiple attribute names,<br>
with duplicate attributes values mapped to different names.</p>
<p>For example, the following configuration will recognize the resolved attribute <code>eduPersonAffiliation</code> and will then release <code>affiliation</code> and <code>personAffiliation</code> whose values stem from the original <code>eduPersonAffiliation</code> attribute while <code>groupMembership</code> is released as <code>group</code>. In other words, the <code>eduPersonAffiliation</code> attribute is released twice under two different names each sharing the same value.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnMappedAttributeReleasePolicy",
    "allowedAttributes" : {
      "@class" : "java.util.TreeMap",
      "eduPersonAffiliation" : [ "java.util.ArrayList", [ "affiliation", "personAffiliation" ] ],
      "groupMembership" : "group"
    }
  }
}
</code></pre>
<h3>
<a id="inline-groovy-attributes" class="anchor" href="#inline-groovy-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Inline Groovy Attributes</h3>
<p>Principal attributes that are mapped may produce their values from an inline groovy script. As an example, if you currently<br>
have resolved a <code>uid</code> attribute with a value of <code>piper</code>, you could then consider the following:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnMappedAttributeReleasePolicy",
    "allowedAttributes" : {
      "@class" : "java.util.TreeMap",
      "uid" : "groovy { return attributes['uid'].get(0) + ' is great' }"
    }
  }
}
</code></pre>
<p>In the above snippet, the value of the <code>uid</code> attribute name is mapped to the result of the inline groovy script.<br>
Inline scripts always begin with the syntax <code>groovy {...}</code> and are passed the current collection of resolved<br>
attributes as an <code>attributes</code> binding variable. The result of the script can be a single/collection of value(s).</p>
<p>The above configuration will produce a <code>uid</code> attribute for the application whose value is a concatenation of<br>
the original value of <code>uid</code> plus the words " is great", so the final result would be "piper is great".</p>
<h3>
<a id="file-based-groovy-attributes" class="anchor" href="#file-based-groovy-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>File-based Groovy Attributes</h3>
<p>Identical to inline groovy attribute definitions, except the groovy script can also be externalized to a <code>.groovy</code> file:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnMappedAttributeReleasePolicy",
    "allowedAttributes" : {
      "@class" : "java.util.TreeMap",
      "uid" : "file:/etc/cas/sample.groovy"
    }
  }
}
</code></pre>
<p>The <code>sample.groovy</code> script itself may have the following outline:</p>
<pre lang="groovy"><code>import java.util.*

def run(final Object... args) {
    def attributes = args[0]
    def logger = args[1]
    logger.debug("Current attributes are {}", attributes)
    return []
}
</code></pre>
<p>The configuration of this component qualifies to use the <a href="../configuration/Configuration-Spring-Expressions.html">Spring Expression Language</a> syntax.</p>
<h3>
<a id="groovy-script" class="anchor" href="#groovy-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Groovy Script</h3>
<p>Let an external Groovy script decide how principal attributes should be released. The configuration of this<br>
component qualifies to use the <a href="../configuration/Configuration-Spring-Expressions.html">Spring Expression Language</a> syntax.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.GroovyScriptAttributeReleasePolicy",
    "groovyScript" : "classpath:/script.groovy"
  }
}
</code></pre>
<p>The script itself may be designed in Groovy as:</p>
<pre lang="groovy"><code>import java.util.*

def Map&lt;String, List&lt;Object&gt;&gt; run(final Object... args) {
    def currentAttributes = args[0]
    def logger = args[1]
    def principal = args[2]
    def service = args[3]

    logger.debug("Current attributes received are {}", currentAttributes)
    return [username:["something"], likes:["cheese", "food"], id:[1234,2,3,4,5], another:"attribute"]
}
</code></pre>
<p>The following parameters are passed to the script:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>currentAttributes</code></td>
<td>
<code>Map</code> of attributes currently resolved and available for release.</td>
</tr>
<tr>
<td><code>logger</code></td>
<td>The object responsible for issuing log messages such as <code>logger.info(...)</code>.</td>
</tr>
<tr>
<td><code>principal</code></td>
<td>The object representing the authenticated principal.</td>
</tr>
<tr>
<td><code>service</code></td>
<td>The object representing the corresponding service definition in the registry.</td>
</tr>
</tbody>
</table>
<h3>
<a id="script-engines" class="anchor" href="#script-engines" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Script Engines</h3>
<!-- raw HTML omitted -->
<p>Use alternative script engine implementations and other programming languages to configure attribute release policies. This approach<br>
takes advantage of scripting functionality built into the Java platform via additional libraries and drivers. While Groovy should be<br>
natively supported by CAS, the following module is required in the overlay to include support for additional languages<br>
such as Python, etc.</p>
<pre lang="xml"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;
    &lt;artifactId&gt;cas-server-support-script-engines&lt;/artifactId&gt;
    &lt;version&gt;${cas.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>The service definition then may be designed as:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ScriptedRegisteredServiceAttributeReleasePolicy",
    "scriptFile" : "classpath:/script.[py|js|groovy]"
  }
}
</code></pre>
<p>The configuration of this component qualifies to use<br>
the <a href="../configuration/Configuration-Spring-Expressions.html">Spring Expression Language</a> syntax. The scripts<br>
need to design a <code>run</code> function that receives a list of parameters. The collection of current attributes in process<br>
as well as a logger object are passed to this function. The result must produce a map whose <code>key</code>s are attributes names<br>
and whose <code>value</code>s are a list of attribute values.</p>
<p>As an example, the script itself may be designed in Groovy as:</p>
<pre lang="groovy"><code>import java.util.*

def Map&lt;String, List&lt;Object&gt;&gt; run(final Object... args) {
    def currentAttributes = args[0]
    def logger = args[1]

    logger.debug("Current attributes received are {}", currentAttributes)
    return[username:["something"], likes:["cheese", "food"], id:[1234,2,3,4,5], another:"attribute"]
}
</code></pre>
<p>Here's the same script written in Python:</p>
<pre lang="python"><code>def run(*Params):
  Attributes = Params[0]
  Logger = Params[1]
  # Calculate attributes and return a new dictionary of attributes...
  return ...
</code></pre>
<p>You are also allowed to stuff inlined groovy scripts into the <code>scriptFile</code> attribute. The script<br>
has access to the collection of resolved <code>attributes</code> as well as a <code>logger</code> object.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ScriptedRegisteredServiceAttributeReleasePolicy",
    "scriptFile" : "groovy { return attributes }"
  }
}
</code></pre>
<h3>
<a id="chaining-policies" class="anchor" href="#chaining-policies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Chaining Policies</h3>
<p>Attribute release policies can be chained together to process multiple rules.<br>
The order of policy invocation is the same as the definition order defined for the service itself.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy": {
    "@class": "org.apereo.cas.services.ChainingAttributeReleasePolicy",
    "mergingPolicy": "replace",
    "policies": [ "java.util.ArrayList",
      [
          {"@class": "..."},
          {"@class": "..."}
      ]
    ]
  }
}
</code></pre>
<p>The following merging policies are supported:</p>
<table>
<thead>
<tr>
<th>Policy</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>replace</code></td>
<td>Attributes are merged such that attributes from the source always replace principal attributes.</td>
</tr>
<tr>
<td><code>add</code></td>
<td>Attributes are merged such that attributes from the source that don't already exist for the principal are produced.</td>
</tr>
<tr>
<td><code>multivalued</code></td>
<td>Attributes with the same name are merged into multi-valued attributes.</td>
</tr>
</tbody>
</table>
<h4>
<a id="ordering-policies" class="anchor" href="#ordering-policies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ordering Policies</h4>
<p>Note that each policy in the chain can be assigned a numeric <code>order</code> that would determine its position in the chain before execution. This<br>
order may be important if you have attribute release policies that should calculate a value dynamically first before passing it onto<br>
the next policy in the chain.</p>
<p>For example, the policy chain below allows CAS to generate an attribute first using the <code>GeneratesFancyAttributeReleasePolicy</code> policy<br>
where the attribute is next passed onto the next policy in the chain, that is <code>ReleaseFancyAttributeReleasePolicy</code>, to decide<br>
whether or not the attribute should be released. Note the configuration of policy <code>order</code> determines the execution sequence.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "sample",
  "name" : "sample",
  "id" : 300,
  "attributeReleasePolicy": {
    "@class": "org.apereo.cas.services.ChainingAttributeReleasePolicy",
    "policies": [ "java.util.ArrayList",
      [
          {
            "@class": "org.apereo.cas.ReleaseFancyAttributeReleasePolicy",
            "order": 1
          },
          {
            "@class": "org.apereo.cas.GeneratesFancyAttributeReleasePolicy", 
            "order": 0
          }
      ]
    ]
  }
}
</code></pre>
<h2>
<a id="attribute-value-filters" class="anchor" href="#attribute-value-filters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attribute Value Filters</h2>
<p>While each policy defines what principal attributes may be allowed for a given service,<br>
there are optional attribute filters that can be set per policy to further weed out attributes based on their <strong>values</strong>.</p>
<p><a href="Attribute-Value-Release-Policies.html">See this guide</a> to learn more.</p>
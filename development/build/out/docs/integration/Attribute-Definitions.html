<hr>
<h2>
<a id="layout-defaulttitle-cas---attribute-definitionscategory-attributes" class="anchor" href="#layout-defaulttitle-cas---attribute-definitionscategory-attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Attribute Definitions<br>
category: Attributes</h2>
<p>{% include variables.html %}</p>
<h1>
<a id="attribute-definitions" class="anchor" href="#attribute-definitions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attribute Definitions</h1>
<p>The definition of an attribute in CAS, when fetched and resolved from an authentication or attribute repository source, tends to be defined<br>
and referenced using its name without any additional <em>metadata</em> or decorations. For example, you may wish to retrieve a <code>uid</code> attribute and virtually<br>
rename and map it to a <code>userIdentifier</code> attribute either globally or for specific application integrations. For most use cases, this configuration<br>
works quite comfortably and yet, depending on the nature of the target application and the authentication protocol used to complete the integration,<br>
additional requirements could be imposed and may have to be specified to define an attribute with additional pointers, when shared and released with a<br>
relying party. For example, a SAML2 service provider may require a <em>scoped</em> attribute for an <code>eduPersonPrincipalName</code> whose value<br>
is always determined from the <code>uid</code> attribute with a special friendly-name that is always provided regardless of the target application.</p>
<p>While bits and pieces of metadata about a given attribute can be defined either globally in CAS configuration settings<br>
or defined inside a service definition, an attribute definition store allows one to describe metadata about necessary attributes<br>
with special decorations to be considered during attribute resolution and release. The specification of the attribute definition store is entirely<br>
optional and the store may not contain any attribute definitions.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#attribute-definitions">review this guide</a>.</p>
<h2>
<a id="json-attribute-definitions" class="anchor" href="#json-attribute-definitions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON Attribute Definitions</h2>
<p>Attribute definitions may be defined inside a JSON file whose location is provided via CAS settings. The structure of the JSON file<br>
may match the following:</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "eduPersonPrincipalName" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "eduPersonPrincipalName",
      "name" : "urn:oid:1.3.6.1.4.1.5923.1.1.1.6",
      "friendlyName" : "eduPersonPrincipalName",
      "scoped" : true,
      "encrypted" : false,
      "attribute" : "uid"
    }
}
</code></pre>
<p>Attribute definitions are specified using a <code>Map</code> whose key is the attribute name, as resolved by the CAS <a href="Attribute-Resolution.html">attribute resolution engine</a>.<br>
The attribute name as the key to the <code>Map</code> must match the <code>key</code> attribute of the attribute definition itself.</p>
<p>The following settings can be specified by an attribute definition:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td>Attribute name, as resolved by the CAS <a href="Attribute-Resolution.html">attribute resolution engine</a>
</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Attribute name to be used and shared with the target application during attribute release.</td>
</tr>
<tr>
<td><code>friendlyName</code></td>
<td>(Optional) Friendly name of the attribute shared with the target application during attribute release.</td>
</tr>
<tr>
<td><code>scoped</code></td>
<td>(Optional) If <code>true</code>, the attribute value be scoped to the scope of the CAS server deployment defined in settings.</td>
</tr>
<tr>
<td><code>encrypted</code></td>
<td>(Optional) If <code>true</code>, the attribute value will be encrypted and encoded in base-64 using the service definition's defined public key.</td>
</tr>
<tr>
<td><code>attribute</code></td>
<td>(Optional) The source attribute to provide values for the attribute definition itself, replacing that of the original source.</td>
</tr>
<tr>
<td><code>patternFormat</code></td>
<td>(Optional) Template used in a <code>java.text.MessageFormat</code> to decorate the attribute values.</td>
</tr>
<tr>
<td><code>script</code></td>
<td>(Optional) Groovy script, external or embedded to process and produce attributes values.</td>
</tr>
</tbody>
</table>
<p>The following operations in the order given should take place, if an attribute definition is to produce values:</p>
<ul>
<li>Produce attribute values based on the <code>attribute</code> setting specified in the attribute definition, if any.</li>
<li>Produce attribute values based on the <code>script</code> setting specified in the attribute definition, if any.</li>
<li>Produce attribute values based on the <code>scoped</code> setting specified in the attribute definition, if any.</li>
<li>Produce attribute values based on the <code>patternFormat</code> setting specified in the attribute definition, if any.</li>
<li>Produce attribute values based on the <code>encrypted</code> setting specified in the attribute definition, if any.</li>
</ul>
<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h2>
<h3>
<a id="basic" class="anchor" href="#basic" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Basic</h3>
<p>Define an attribute definition for <code>employeeId</code> to produce scoped attributes<br>
based on another attribute <code>empl_identifier</code> as the source:</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "employeeId" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "employeeId",
      "scoped" : true,
      "attribute" : "empl_identifier"
    }
}
</code></pre>
<p>Now that the definition is available globally, the attribute <a href="Attribute-Release-Policies.html">can then be released</a><br>
as usual with the following definition:</p>
<pre lang="json"><code>...
  "attributeReleasePolicy" : {
    "@class" : "org.apereo.cas.services.ReturnAllowedAttributeReleasePolicy",
    "allowedAttributes" : [ "java.util.ArrayList", [ "employeeId" ] ]
  }
...
</code></pre>
<h3>
<a id="encrypted-attribute" class="anchor" href="#encrypted-attribute" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Encrypted Attribute</h3>
<p>Same use case as above, except the attribute value will be encrypted and encoded using the service definition's public key:</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "employeeId" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "employeeId",
      "encrypted" : true,
      "attribute" : "empl_identifier"
    }
}
</code></pre>
<p>The service definition should have specified a public key definition:</p>
<pre lang="json"><code>...
  "publicKey" : {
    "@class" : "org.apereo.cas.services.RegisteredServicePublicKeyImpl",
    "location" : "classpath:public.key",
    "algorithm" : "RSA"
  }
...
</code></pre>
<p>The keys can be generated via the following commands:</p>
<pre lang="bash"><code>openssl genrsa -out private.key 1024
openssl rsa -pubout -in private.key -out public.key -inform PEM -outform DER
openssl pkcs8 -topk8 -inform PER -outform DER -nocrypt -in private.key -out private.p8
</code></pre>
<h3>
<a id="pattern-formats" class="anchor" href="#pattern-formats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pattern Formats</h3>
<p>Define an attribute definition to produce values based on a pattern format:</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "eduPersonPrincipalName" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "eduPersonPrincipalName",
      "name" : "urn:oid:1.3.6.1.4.1.5923.1.1.1.6",
      "friendlyName" : "eduPersonPrincipalName",
      "scoped" : true,
      "patternFormat": "hello,{0}",
      "attribute" : "uid"
    }
}
</code></pre>
<p>If the resolved set of attributes are <code>uid=[test1, test2]</code> and the CAS server has a scope of <code>example.org</code>,<br>
the final values of <code>eduPersonPrincipalName</code> would be [<code>hello,test1@example.org</code>,<code>hello,test2@example.org</code>]<br>
released as <code>urn:oid:1.3.6.1.4.1.5923.1.1.1.6</code> with a friendly name of <code>eduPersonPrincipalName</code>.</p>
<h3>
<a id="embedded-script" class="anchor" href="#embedded-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Embedded Script</h3>
<p>Same use case as above, except the attribute value be additional processed by an embedded Groovy script</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "eduPersonPrincipalName" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "eduPersonPrincipalName",
      "name" : "urn:oid:1.3.6.1.4.1.5923.1.1.1.6",
      "friendlyName" : "eduPersonPrincipalName",
      "scoped" : true,
      "script": " groovy { logger.info(\" name: ${attributeName}, values: ${attributeValues} \"); return ['hello', 'world'] } "
    }
}
</code></pre>
<p>If the CAS server has a scope of <code>example.org</code>,<br>
the final values of <code>eduPersonPrincipalName</code> would be [<code>hello@example.org</code>, <code>world@example.org</code>]<br>
released as <code>urn:oid:1.3.6.1.4.1.5923.1.1.1.6</code> with a friendly name of <code>eduPersonPrincipalName</code>.</p>
<h3>
<a id="external-script" class="anchor" href="#external-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>External Script</h3>
<p>Same use case as above, except the attribute value be additionally processed by an external Groovy script:</p>
<pre lang="json"><code>{
    "@class" : "java.util.TreeMap",
    "eduPersonPrincipalName" : {
      "@class" : "org.apereo.cas.authentication.attribute.DefaultAttributeDefinition",
      "key" : "eduPersonPrincipalName",
      "name" : "urn:oid:1.3.6.1.4.1.5923.1.1.1.6",
      "friendlyName" : "eduPersonPrincipalName",
      "scoped" : true,
      "script": "file:/attribute-definitions.groovy"
    }
}
</code></pre>
<p>The outline of the Groovy script should be defined as:</p>
<pre lang="groovy"><code>def run(Object[] args) {
    def attributeName = args[0]
    def attributeValues = args[1]
    def logger = args[2]
    logger.info("name: ${attributeName}, values: ${attributeValues}")
    return ["casuser", "groovy"]
}
</code></pre>
<p>If the CAS server has a scope of <code>example.org</code>,<br>
the final values of <code>eduPersonPrincipalName</code> would be [<code>casuser@example.org</code>, <code>groovy@example.org</code>]<br>
released as <code>urn:oid:1.3.6.1.4.1.5923.1.1.1.6</code> with a friendly name of <code>eduPersonPrincipalName</code>.</p>
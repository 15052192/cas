<hr>
<h2>
<a id="layout-defaulttitle-cas---google-apps-integrationcategory-integration" class="anchor" href="#layout-defaulttitle-cas---google-apps-integrationcategory-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Google Apps Integration<br>
category: Integration</h2>
<h1>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p>Google Apps for Education (or any of the Google Apps) utilizes SAML 2.0 to provide an<br>
integration point for external authentication services.</p>
<!-- raw HTML omitted -->
<p>Support is enabled by including the following dependency in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-saml-googleapps" %}</p>
<h2>
<a id="generate-publicprivate-keys" class="anchor" href="#generate-publicprivate-keys" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generate Public/Private Keys</h2>
<p>The first step is to generate DSA/RSA public and private keys. These are used to sign and read the Assertions.<br>
After keys are created, the public key needs to be registered with Google.</p>
<p>The keys will also need to be available to the CAS application (but not publicly available over the Internet)<br>
via the classpath though any location accessible by the user running the web server<br>
instance and not served publicly to the Internet is acceptable.  Thus, inside <code>src/main/resources</code> is<br>
nice because it is scoped to the web application but not normally served. <code>/etc/cas/</code><br>
is also fine as well and protects the key from being overwritten on deploy of a new CAS webapp version.</p>
<pre lang="bash"><code>openssl genrsa -out private.key 1024
openssl rsa -pubout -in private.key -out public.key -inform PEM -outform DER
openssl pkcs8 -topk8 -inform PER -outform DER -nocrypt -in private.key -out private.p8
openssl req -new -x509 -key private.key -out x509.pem -days 365
</code></pre>
<p>The <code>x509.pem</code> file should be uploaded into Google Apps under Security/SSO.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#google-apps-authentication">review this guide</a>.</p>
<h2>
<a id="register-google-apps" class="anchor" href="#register-google-apps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Register Google Apps</h2>
<p>Ensure that Google Apps is registered in your <a href="../services/Service-Management.html">service registry</a>.</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "https://www.google.com/a/YourGoogleDomain/acs",
  "name" : "googleApps",
  "id" : 1000,
  "evaluationOrder" : 10
}
</code></pre>
<h2>
<a id="configure-username-attribute" class="anchor" href="#configure-username-attribute" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configure Username Attribute</h2>
<p>As an optional step, you can configure an alternate username to be send to Google in the SAML reply. This alternate user name<br>
can be specified in the CAS service registry via <a href="../services/Service-Management.html">username attribute providers</a><br>
for the registered Google Apps service.</p>
<h2>
<a id="configure-google" class="anchor" href="#configure-google" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configure Google</h2>
<p>You'll need to provide Google with the URL for your SAML-based SSO service, as well as the URL your users will<br>
be redirected to when they log out of a hosted Google application.<br>
Use the following URLs when you are configuring for Google Apps:</p>
<ul>
<li>Sign-in page URL: <code>https://sso.school.edu/cas/login</code>
</li>
<li>Sign-out page URL: <code>https://sso.school.edu/cas/logout</code>
</li>
<li>Change password URL: <code>https://mgmt.password.edu/</code>
</li>
</ul>
<h2>
<a id="test" class="anchor" href="#test" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Test</h2>
<p>Attempt to access a Google-hosted application, such as Google Calendar<br>
with the url: <code>https://calendar.google.com/a/YourGoogleDomain</code></p>
<hr>
<h2>
<a id="layout-defaulttitle-cas---audit-configurationcategory-logs--audits" class="anchor" href="#layout-defaulttitle-cas---audit-configurationcategory-logs--audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Audit Configuration<br>
category: Logs &amp; Audits</h2>
<p>{% include variables.html %}</p>
<h1>
<a id="audits" class="anchor" href="#audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Audits</h1>
<p>CAS uses the <a href="https://github.com/apereo/inspektr">Inspektr framework</a> for auditing purposes<br>
and statistics. The Inspektr project allows for non-intrusive auditing and logging of the<br>
coarse-grained execution paths e.g. Spring-managed beans method executions by using annotations<br>
and Spring-managed <code>@Aspect</code>-style aspects.</p>
<p>CAS server auto-configures all the relevant Inspektr components.   All the available configuration options that are injected to Inspektr classes are available to deployers via relevant CAS properties. Note that the audit record management functionality of CAS supports handling multiple audit record destinations at the same time. In other words, you may choose to route audit records to both a database and a REST endpoint as well as any number of logger-based destinations all at the same time.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#audits">review this guide</a>.</p>
<h2>
<a id="administrative-endpoints" class="anchor" href="#administrative-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Administrative Endpoints</h2>
<p>The following endpoints are provided by CAS:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auditLog</code></td>
<td>Provides a JSON representation of all the audit log.</td>
</tr>
</tbody>
</table>
<p>You can specify an interval of log entries to return by adding a Duration Syntax to the navigated path. This interval will be subtracted from the current<br>
date and time when the query is executed. For instance <code>/actuator/auditLog/PT1H</code> will return only entries for the past hour.</p>
<p>The actuator endpoint can also accept a JSON object through a POST method containing criteria to filter log entries by.</p>
<p>The following filters that can be applied:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>interval</code></td>
<td>
<code>PT1H</code>, <code>PT10M</code>, <code>P1D</code>
</td>
</tr>
<tr>
<td><code>actionPerformed</code></td>
<td>
<code>TICKET_GRANTING_TICKET_CREATED</code>, <code>SERVICE_TICK.*</code>
</td>
</tr>
<tr>
<td><code>clientIpAddress</code></td>
<td>
<code>111.111.111.111</code>, <code>111.111.*</code>
</td>
</tr>
<tr>
<td><code>username</code></td>
<td>
<code>casuser</code>, <code>cas.*</code>
</td>
</tr>
<tr>
<td><code>resourceOperatedOn</code></td>
<td>
<code>ST-1.*</code>, <code>TGT-1-.*</code>
</td>
</tr>
</tbody>
</table>
<p>Each filter other than <code>interval</code> can accept a regular expression to match against.</p>
<h2>
<a id="file-based-audits" class="anchor" href="#file-based-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>File-based Audits</h2>
<p>File-based audit logs appear in a <code>cas_audit.log</code> file defined in the <a href="../logging/Logging.html">Logging</a> configuration.<br>
To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#audits">review this guide</a>.</p>
<h3>
<a id="sample-log-output" class="anchor" href="#sample-log-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sample Log Output</h3>
<pre lang="bash"><code>WHO: org.apereo.cas.support.oauth.authentication.principal.OAuthCredentials@6cd7c975
WHAT: supplied credentials: org.apereo.cas.support.oauth.authentication.principal.OAuthCredentials@6cd7c975
ACTION: AUTHENTICATION_SUCCESS
APPLICATION: CAS
WHEN: Mon Aug 26 12:35:59 IST 2013
CLIENT IP ADDRESS: 172.16.5.181
SERVER IP ADDRESS: 192.168.200.22

WHO: org.apereo.cas.support.oauth.authentication.principal.OAuthCredentials@6cd7c975
WHAT: TGT-9-qj2jZKQUmu1gQvXNf7tXQOJPOtROvOuvYAxybhZiVrdZ6pCUwW-cas01.example.org
ACTION: TICKET_GRANTING_TICKET_CREATED
APPLICATION: CAS
WHEN: Mon Aug 26 12:35:59 IST 2013
CLIENT IP ADDRESS: 172.16.5.181
SERVER IP ADDRESS: 192.168.200.22
</code></pre>
<h2>
<a id="database-audits" class="anchor" href="#database-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Database Audits</h2>
<p>If you intend to use a database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-jdbc" %}</p>
<p>To learn how to configure database drivers, please <a href="JDBC-Drivers.html">review this guide</a>.<br>
To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#database-audits">review this guide</a>.</p>
<h2>
<a id="mongodb-audits" class="anchor" href="#mongodb-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MongoDb Audits</h2>
<p>If you intend to use a MongoDb database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-mongo" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#mongodb-audits">review this guide</a>.</p>
<h2>
<a id="redis-audits" class="anchor" href="#redis-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Redis Audits</h2>
<p>If you intend to use a Redis database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-redis" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#redis-audits">review this guide</a>.</p>
<h2>
<a id="couchdb-audits" class="anchor" href="#couchdb-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CouchDb Audits</h2>
<p>If you intend to use a CouchDb database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-couchdb" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#couchdb-audits">review this guide</a>.</p>
<h2>
<a id="couchbase-audits" class="anchor" href="#couchbase-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Couchbase Audits</h2>
<p>If you intend to use a Couchbase database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-couchbase" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#couchbase-audits">review this guide</a>.</p>
<h2>
<a id="dynamodb-audits" class="anchor" href="#dynamodb-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DynamoDb Audits</h2>
<p>If you intend to use a DynamoDb database for auditing functionality, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-dynamodb" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#dynamodb-audits">review this guide</a>.</p>
<h2>
<a id="rest-audits" class="anchor" href="#rest-audits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST Audits</h2>
<p>Audit events may also be <code>POST</code>ed to an endpoint of your choosing. To activate this feature, enable the following module in your configuration:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-audit-rest" %}</p>
<p>The body of the HTTP request is a JSON representation of the audit record.<br>
To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#rest-audits">review this guide</a>.</p>
<h2>
<a id="audit-events" class="anchor" href="#audit-events" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Audit Events</h2>
<p>The following events are tracked and recorded in the audit log:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TICKET_GRANTING_TICKET</code></td>
<td>
<code>CREATED</code>, <code>NOT_CREATED</code>, <code>DESTROYED</code>
</td>
</tr>
<tr>
<td><code>PROXY_GRANTING_TICKET</code></td>
<td>
<code>CREATED</code>, <code>NOT_CREATED</code>, <code>DESTROYED</code>
</td>
</tr>
<tr>
<td><code>SERVICE_TICKET</code></td>
<td>
<code>CREATED</code>, <code>NOT_CREATED</code>
</td>
</tr>
<tr>
<td><code>PROXY_TICKET</code></td>
<td>
<code>CREATED</code>, <code>NOT_CREATED</code>
</td>
</tr>
<tr>
<td><code>AUTHENTICATION</code></td>
<td>
<code>SUCCESS</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>AUTHENTICATION_EVENT</code></td>
<td><code>TRIGGERED</code></td>
</tr>
<tr>
<td><code>AUP_VERIFY</code></td>
<td><code>TRIGGERED</code></td>
</tr>
<tr>
<td><code>AUP_SUBMIT</code></td>
<td><code>TRIGGERED</code></td>
</tr>
<tr>
<td><code>EVALUATE_RISKY_AUTHENTICATION</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>MITIGATE_RISKY_AUTHENTICATION</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>MULTIFACTOR_AUTHENTICATION_BYPASS</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>SAVE_SERVICE</code></td>
<td>
<code>SUCCESS</code>, <code>FAILURE</code>
</td>
</tr>
<tr>
<td><code>SAVE_CONSENT</code></td>
<td>
<code>SUCCESS</code>, <code>FAILURE</code>
</td>
</tr>
<tr>
<td><code>CHANGE_PASSWORD</code></td>
<td>
<code>SUCCESS</code>, <code>FAILURE</code>
</td>
</tr>
<tr>
<td><code>DELETE_SERVICE</code></td>
<td>
<code>SUCCESS</code>, <code>FAILURE</code>
</td>
</tr>
<tr>
<td><code>SAML2_RESPONSE</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>SAML2_REQUEST</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>OAUTH2_USER_PROFILE</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>OAUTH2_ACCESS_TOKEN_REQUEST</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>OAUTH2_ACCESS_TOKEN_RESPONSE</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>OAUTH2_CODE_RESPONSE</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>REST_API_TICKET_GRANTING_TICKET</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>REST_API_SERVICE_TICKET</code></td>
<td>
<code>CREATED</code>, <code>FAILED</code>
</td>
</tr>
<tr>
<td><code>SERVICE_ACCESS_ENFORCEMENT</code></td>
<td><code>TRIGGERED</code></td>
</tr>
<tr>
<td><code>DELEGATED_CLIENT</code></td>
<td>
<code>SUCCESS</code>, <code>FAILURE</code>
</td>
</tr>
<tr>
<td><code>SURROGATE_AUTHENTICATION_ELIGIBILITY_VERIFICATION</code></td>
<td><code>TRIGGERED</code></td>
</tr>
<tr>
<td><code>SURROGATE_AUTHENTICATION_ELIGIBILITY_SELECTION</code></td>
<td><code>TRIGGERED</code></td>
</tr>
</tbody>
</table>
<hr>
<h2>
<a id="layout-defaulttitle-cas---passwordless-authenticationcategory-authentication" class="anchor" href="#layout-defaulttitle-cas---passwordless-authenticationcategory-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Passwordless Authentication<br>
category: Authentication</h2>
<p>{% include variables.html %}</p>
<h1>
<a id="passwordless-authentication" class="anchor" href="#passwordless-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passwordless Authentication</h1>
<p>Passwordless Authentication is a form of authentication in CAS where passwords take the<br>
form of tokens that expire after a configurable period of time.<br>
Using this strategy, users are asked for an identifier (i.e. username) which is used to locate the user record<br>
that contains forms of contact such as email and phone<br>
number. Once located, the CAS-generated token is sent to the user via the configured notification<br>
strategies (i.e. email, sms, etc) where the user is then expected to<br>
provide the token back to CAS in order to proceed.</p>
<!-- raw HTML omitted -->
<p>In order to successfully implement this feature, configuration needs to be in place to contact<br>
account stores that hold user records who qualify for passwordless authentication.<br>
Similarly, CAS must be configured to manage issued tokens in order to execute find,<br>
validate, expire or save operations in appropriate data stores.</p>
<h2>
<a id="passwordless-variants" class="anchor" href="#passwordless-variants" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Passwordless Variants</h2>
<p>Passwordless authentication can also be activated using <a href="QRCode-Authentication.html">QR Code Authentication</a>,<br>
allowing end users to login by scanning a QR code using a mobile device.</p>
<p>Passwordless authentication can also be achieved via <a href="../mfa/FIDO2-WebAuthn-Authentication.html">FIDO2 WebAuthn</a> which lets users<br>
verify their identities without passwords and login using FIDO2-enabled devices.</p>
<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>
<p>Support is enabled by including the following module in the overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-passwordless-webflow" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
<h2>
<a id="account-stores" class="anchor" href="#account-stores" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Account Stores</h2>
<p>User records that qualify for passwordless authentication must be found by CAS using one of the following strategies. All strategies may be configured<br>
using CAS settings and are activated depending on the presence of configuration values.</p>
<h3>
<a id="simple" class="anchor" href="#simple" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple</h3>
<p>This strategy provides a static map of usernames that are linked to their method of contact, such as email or phone number. It is best used<br>
for testing and demo purposes. The key in the map is taken to be the username eligible for authentication while the value can either be an email<br>
address or phone number that would be used to contact the user with issued tokens.</p>
<h3>
<a id="mongodb" class="anchor" href="#mongodb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MongoDb</h3>
<p>This strategy allows one to locate a user record in MongoDb. The designated MongoDb collection is expectd to carry objects of type <code>PasswordlessUserAccount</code> in JSON format. To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
<p>Support is enabled by including the following module in the overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-passwordless-mongo" %}</p>
<h3>
<a id="ldap" class="anchor" href="#ldap" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LDAP</h3>
<p>This strategy allows one to locate a user record in an LDAP directory. The record is expected to carry the user's phone number<br>
or email address via configurable attributes. To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
<p>Support is enabled by including the following module in the overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-passwordless-ldap" %}</p>
<h3>
<a id="json" class="anchor" href="#json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON</h3>
<p>This strategy allows one to locate user records via a JSON resource, as such:</p>
<pre lang="json"><code>{
  "@class" : "java.util.LinkedHashMap",
  "casuser" : {
    "@class": "org.apereo.cas.api.PasswordlessUserAccount",
    "username": "casuser",
    "attributes": {
        "@class": "java.util.LinkedHashMap",
        "name": [ "java.util.ArrayList", ["value"] ]
    },
    "multifactorAuthenticationEligible": "TRUE",
    "delegatedAuthenticationEligible": "TRUE",
    "requestPassword": false
  }
}
</code></pre>
<h3>
<a id="groovy" class="anchor" href="#groovy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Groovy</h3>
<p>This strategy allows one to locate user records via a Groovy script. The body of the script may be defined as such:</p>
<pre lang="groovy"><code>import org.apereo.cas.api.*

def run(Object[] args) {
    def username = args[0]
    def logger = args[1]
    
    logger.info("Locating user record for user $username")
    
    /*
     ...
     Locate the record for the given username, and return the result back to CAS.
     ...
    */
    
    def account = new PasswordlessUserAccount()
    account.setUsername(username)
    account.setEmail("username@example.org")
    account.setName("TestUser")
    account.setPhone("123-456-7890") 
    account.setAttributes(Map.of("...", List.of("...", "...")) 
    account.setMultifactorAuthenticationEligible(TriStateBoolean.FALSE)  
    account.setRequestPassword(false)
    return account
}
</code></pre>
<h3>
<a id="rest" class="anchor" href="#rest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST</h3>
<p>This strategy allows one design REST endpoints in charge of locating passwordless user records. A successful execution of the endpoint<br>
would produce a response body similar to the following:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.api.PasswordlessUserAccount",
  "username" : "casuser",
  "email" : "cas@example.org",
  "phone" : "123-456-7890",
  "name" : "CASUser",        
  "multifactorAuthenticationEligible": "FALSE",  
  "delegatedAuthenticationEligible": "FALSE",  
  "requestPassword": false,
  "attributes":{ "lastName" : ["...", "..."] }
}
</code></pre>
<h3>
<a id="custom" class="anchor" href="#custom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom</h3>
<p>You may also define your own user account store using the following bean definition and by implementing <code>PasswordlessUserAccountStore</code>:</p>
<pre lang="java"><code>@Bean
public PasswordlessUserAccountStore passwordlessUserAccountStore() {
    ...
}
</code></pre>
<p><a href="../configuration/Configuration-Management-Extensions.html">See this guide</a> to learn more about how to register configurations into the CAS runtime.</p>
<h2>
<a id="token-management" class="anchor" href="#token-management" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Token Management</h2>
<p>The following strategies define how issued tokens may be managed by CAS.</p>
<h3>
<a id="memory" class="anchor" href="#memory" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Memory</h3>
<p>This is the default option where tokens are kept in memory using a cache with a configurable expiration period. Needless to say, this option<br>
is not appropriate in clustered CAS deployments inside there is not a way to synchronize and replicate tokens across CAS nodes.</p>
<h3>
<a id="jpa" class="anchor" href="#jpa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JPA</h3>
<p>This strategy allows one to store tokens and manage their expiration policy using a relational database.</p>
<p>Support is enabled by including the following module in the overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-passwordless-jpa" %}</p>
<p>To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
<h3>
<a id="rest-1" class="anchor" href="#rest-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST</h3>
<p>This strategy allows one design REST endpoints in charge of managing tokens and their expiration policy entirely.<br>
CAS continues to generate tokens and the endpoint is only acting as a facade to the real token store, receiving tokens from CAS<br>
in an encrypted fashion.</p>
<p>The following operations need to be supported by the endpoint:</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>Description</th>
<th>Parameter(s)</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET</code></td>
<td>Locate tokens for the user.</td>
<td><code>username</code></td>
<td>Token in the response body.</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td>Delete all tokens for the user.</td>
<td><code>username</code></td>
<td>N/A</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td>Delete a single token for the user.</td>
<td>
<code>username</code>, <code>token</code>
</td>
<td>N/A</td>
</tr>
<tr>
<td><code>POST</code></td>
<td>Save a token for the user.</td>
<td>
<code>username</code>, <code>token</code>
</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h3>
<a id="custom-1" class="anchor" href="#custom-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom</h3>
<p>You may also define your own token management store using the following bean definition and by implementing <code>PasswordlessTokenRepository</code>:</p>
<pre lang="java"><code>@Bean
public PasswordlessTokenRepository passwordlessTokenRepository() {
    ...
}
</code></pre>
<p><a href="../configuration/Configuration-Management-Extensions.html">See this guide</a> to learn more about how to register configurations into the CAS runtime.</p>
<h3>
<a id="messaging--notifications" class="anchor" href="#messaging--notifications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Messaging &amp; Notifications</h3>
<p>Users may be notified of tokens via text messages, mail, etc.<br>
To learn more about available options, please <a href="../notifications/SMS-Messaging-Configuration.html">see this guide</a><br>
or <a href="../notifications/Sending-Email-Configuration.html">this guide</a>.</p>
<h2>
<a id="disabling-passwordless-authentication-flow" class="anchor" href="#disabling-passwordless-authentication-flow" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Disabling Passwordless Authentication Flow</h2>
<p>Passwordless authentication can be disabled conditionally on a per-user basis. If the passwordless account retrieved from the account store<br>
carries a user whose <code>requestPassword</code> is set to <code>true</code>, the passwordless flow (i.e. as described above with token generation, etc) will<br>
be disabled and skipped in favor of the more usual CAS authentication flow, challenging the user for a password. Support for this behavior may depend<br>
on each individual account store implementation.</p>
<h2>
<a id="multifactor-authentication-integration" class="anchor" href="#multifactor-authentication-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multifactor Authentication Integration</h2>
<p>Passwordless authentication can be integrated<br>
with <a href="../mfa/Configuring-Multifactor-Authentication.html">CAS multifactor authentication providers</a>. In this scenario,<br>
once CAS configuration is enabled to support this behavior via settings<br>
or the located passwordless user account is considered <em>eligible</em> for multifactor authentication,<br>
CAS will allow passwordless authentication to skip its own <em>intended normal</em> flow (i.e. as described above with token generation, etc) in favor of<br>
multifactor authentication providers that may be available and defined in CAS.</p>
<p>This means that if <a href="../mfa/Configuring-Multifactor-Authentication.html">multifactor authentication providers</a> are defined and activated, and defined<br>
<a href="../mfa/Configuring-Multifactor-Authentication-Triggers.html">multifactor triggers</a> in CAS signal availability and eligibility of an multifactor flow for the given passwordless user, CAS will skip<br>
its normal passwordless authentication flow in favor of the requested multifactor authentication provider and its flow. If no multifactor providers<br>
are available, or if no triggers require the use of multifactor authentication for the verified passwordless user, passwordless<br>
authentication flow will commence as usual.</p>
<p>To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
<h2>
<a id="delegated-authentication-integration" class="anchor" href="#delegated-authentication-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delegated Authentication Integration</h2>
<p>Passwordless authentication can be integrated with <a href="../integration/Delegate-Authentication.html">CAS delegated authentication</a>. In this scenario,<br>
once CAS configuration is enabled to support this behavior via settings or the located passwordless user account is considered <em>eligible</em> for delegated authentication,<br>
CAS will allow passwordless authentication to skip its own <em>intended normal</em> flow (i.e. as described above with token generation, etc) in favor of<br>
delegated authentication that may be available and defined in CAS.</p>
<p>This means that if <a href="../integration/Delegate-Authentication.html">delegated authentication providers</a> are defined and activated, CAS will skip<br>
its normal passwordless authentication flow in favor of the requested multifactor authentication provider and its flow. If no delegated identity providers<br>
are available, passwordless authentication flow will commence as usual.</p>
<p>The selection of a delegated authentication identity provider for a passwordless user is handled<br>
using a script. The script may be defined as such:</p>
<pre lang="groovy"><code>def run(Object[] args) {
    def passwordlessUser = args[0]
    def clients = (Set) args[1]
    def httpServletRequest = args[2]
    def logger = args[3]
    
    logger.info("Testing username $passwordlessUser")

    return clients[0]
}
</code></pre>
<p>The parameters passed are as follows:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>passwordlessUser</code></td>
<td>The object representing the <code>PasswordlessUserAccount</code>.</td>
</tr>
<tr>
<td><code>clients</code></td>
<td>The object representing the collection of identity provider configurations.</td>
</tr>
<tr>
<td><code>httpServletRequest</code></td>
<td>The object representing the http request.</td>
</tr>
<tr>
<td><code>logger</code></td>
<td>The object responsible for issuing log messages such as <code>logger.info(...)</code>.</td>
</tr>
</tbody>
</table>
<p>The outcome of the script can be <code>null</code> to skip delegated authentication for the user, or it could a selection from the available identity providers<br>
passed into the script.</p>
<p>To see the relevant list of CAS<br>
properties, please <a href="../configuration/Configuration-Properties.html#passwordless-authentication">review this guide</a>.</p>
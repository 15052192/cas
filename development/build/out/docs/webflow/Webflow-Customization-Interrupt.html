<hr>
<h2>
<a id="layout-defaulttitle-cas---authentication-interruptcategory-webflow-management" class="anchor" href="#layout-defaulttitle-cas---authentication-interruptcategory-webflow-management" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout: default<br>
title: CAS - Authentication Interrupt<br>
category: Webflow Management</h2>
<p>{% include variables.html %}</p>
<h1>
<a id="authentication-interrupt" class="anchor" href="#authentication-interrupt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication Interrupt</h1>
<p>CAS has the ability to pause and interrupt the authentication flow to reach out to external services and resources, querying for status and settings that<br>
would then dictate how CAS should manage and control the SSO session. Interrupt services are able to present notification messages to the user, provide options for redirects to external services, etc. A common use case deals with presenting a <em>bulletin board</em> during the authentication flow to present messages and announcements to select users and then optionally require the audience to complete a certain task before CAS is able to honor the authentication request and establish a session.</p>
<!-- raw HTML omitted -->
<p>In the interrupt flow, CAS is not at the moment reaching back to an external resource acting as an interrupt service to store, track or remember a user's decision. In other words, we are only dealing with the <code>R</code> (ie. Read) in <code>CRUD</code>. Today's functionality only deals with inquiring status and reading results solely in read-only mode. Interrupt services are themselves required and encouraged to redirect the audience to external resources where execution of an action resets the interrupt status thereby freeing CAS to proceed forward later on without having to interrupt the authentication flow again.</p>
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>Support is enabled by including the following dependency in the WAR overlay:</p>
<p>{% include casmodule.html group="org.apereo.cas" module="cas-server-support-interrupt-webflow" %}</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#authentication-interrupt">review this guide</a>.</p>
<h2>
<a id="interrupt-payload" class="anchor" href="#interrupt-payload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interrupt Payload</h2>
<p>Each interrupt strategy is ultimately tasked to produce a response that contains the following settings:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>message</code></td>
<td>Announcement message to display on the screen.</td>
</tr>
<tr>
<td><code>links</code></td>
<td>A map of links to display on the screen where key is the link text and value is the destination.</td>
</tr>
<tr>
<td><code>interrupt</code></td>
<td>
<code>true/false</code> to indicate whether CAS should interrupt the authentication flow.</td>
</tr>
<tr>
<td><code>block</code></td>
<td>
<code>true/false</code> to indicate whether CAS should block the authentication flow altogether.</td>
</tr>
<tr>
<td><code>ssoEnabled</code></td>
<td>
<code>true/false</code> to indicate whether CAS should permit the authentication but not establish SSO.</td>
</tr>
<tr>
<td><code>autoRedirect</code></td>
<td>
<code>true/false</code> to indicate whether CAS should auto-redirect to the first provided link.</td>
</tr>
<tr>
<td><code>autoRedirectAfterSeconds</code></td>
<td>Indicate whether CAS should auto-redirect after the configured number of seconds. The default is <code>-1</code>, meaning delayed redirect functionality should not be executed.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<h2>
<a id="interrupt-strategies" class="anchor" href="#interrupt-strategies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interrupt Strategies</h2>
<p>Interrupt queries can be executed via the following ways:</p>
<h3>
<a id="json" class="anchor" href="#json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON</h3>
<p>This strategy reaches out to a static JSON resource that contains a map of usernames linked to various interrupt policies.<br>
This option is most useful during development, testing and demos.</p>
<pre lang="json"><code>{
  "casuser" : {
    "message" : "Announcement message &lt;strong&gt;goes here&lt;/strong&gt;.",
    "links" : {
      "Go to Location1" : "https://www.location1.com",
      "Go to Location2" : "https://www.location2.com"
    },
    "block" : false,
    "ssoEnabled" : false,
    "interrupt" : true,
    "autoRedirect" : false,
    "autoRedirectAfterSeconds" : -1,
    "data" : {
      "field1" : [ "value1", "value2" ],
      "field2" : [ "value3", "value4" ]
    }
  }
}
</code></pre>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#authentication-interrupt-json">review this guide</a>.</p>
<h3>
<a id="regex-attribute" class="anchor" href="#regex-attribute" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Regex Attribute</h3>
<p>This strategy allows one to define regular expression patterns in CAS settings that would be matched against attributes names and values.<br>
If a successful match is produced while CAS examines the collection of both authentication and principal attributes, the authentication flow<br>
would be interrupted.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#authentication-interrupt-regex-attributes">review this guide</a>.</p>
<h3>
<a id="groovy" class="anchor" href="#groovy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Groovy</h3>
<p>This strategy reaches out to a Groovy resource whose job is to dynamically calculate whether the authentication flow should be interrupted given the provided username and certain number of other parameters.</p>
<p>The script may be defined as:</p>
<pre lang="groovy"><code>import org.apereo.cas.interrupt.InterruptResponse

def run(final Object... args) {
    def principal = args[0]
    def attributes = args[1]
    def service = args[2]
    def registeredService = args[3]
    def requestContext = args[4]
    def logger = args[5]

    ...
    def block = false
    def ssoEnabled = true

    return new InterruptResponse("Message", [link1:"google.com", link2:"yahoo.com"], block, ssoEnabled)
}
</code></pre>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#authentication-interrupt-groovy">review this guide</a>.</p>
<p>The following parameters are passed to the script:</p>
<p>| Parameter             | Description<br>
|------------------------------------------------------------------------------------------------------------------------<br>
| <code>principal</code>           | Authenticated principal.<br>
| <code>attributes</code>          | A map of type <code>Map&lt;String, Object&gt;</code> that contains both principal and authentication attributes.<br>
| <code>service</code>             | The <code>Service</code> object representing the requesting application.<br>
| <code>registeredService</code>   | The <code>RegisteredService</code> object representing the service definition in the registry.<br>
| <code>requestContext</code>      | The object representing the Spring Webflow <code>RequestContext</code>.<br>
| <code>logger</code>              | The object responsible for issuing log messages such as <code>logger.info(...)</code>.</p>
<h3>
<a id="rest" class="anchor" href="#rest" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST</h3>
<p>This strategy reaches out to a REST endpoint resource whose job is to dynamically calculate whether the authentication flow should be interrupted given the following parameters:</p>
<p>| Parameter             | Description<br>
|-------------------------------------------------------------------------------------------------------<br>
| <code>username</code>            | Authenticated principal id.<br>
| <code>service</code>             | The identifier (URL) for the requesting application.<br>
| <code>registeredService</code>   | The identifier of the registered service matched and found in the registry.</p>
<p>On a successful operation with a status code of <code>200</code>, the response body is expected to contain the JSON payload whose syntax and structure is identical to what is described above.</p>
<p>To see the relevant list of CAS properties, please <a href="../configuration/Configuration-Properties.html#authentication-interrupt-rest">review this guide</a>.</p>
<h3>
<a id="custom" class="anchor" href="#custom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom</h3>
<p>If you wish to design your own interrupt strategy to make inquiries, you can design your component to make determinations:</p>
<pre lang="java"><code>package org.apereo.cas.support.interrupt;

@Configuration("myInterruptConfiguration")
@EnableConfigurationProperties(CasConfigurationProperties.class)
public class MyInterruptConfiguration {
    @Bean
    public InterruptInquirer interruptInquirer() {
      ...
    }

    @Bean
    public InterruptInquiryExecutionPlanConfigurer myInterruptInquiryExecutionPlanConfigurer() {
        return plan -&gt; {
            plan.registerInterruptInquirer(interruptInquirer());
        };
    }
}
</code></pre>
<p><a href="../configuration/Configuration-Management-Extensions.html">See this guide</a> to learn more about how to register configurations into the CAS runtime.</p>
<h2>
<a id="skipping-interrupts" class="anchor" href="#skipping-interrupts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Skipping Interrupts</h2>
<p>Interrupt notifications may be disabled on a per-service basis. A sample JSON file follows:</p>
<pre lang="json"><code>{
  "@class" : "org.apereo.cas.services.RegexRegisteredService",
  "serviceId" : "^https://.+",
  "name" : "sample service",
  "id" : 100,
  "properties" : {
    "@class" : "java.util.HashMap",
    "skipInterrupt" : {
      "@class" : "org.apereo.cas.services.DefaultRegisteredServiceProperty",
      "values" : [ "java.util.HashSet", [ "true" ] ]
    }
  }
}
</code></pre>